<script>

const NOTIFICACION_OK = 1;
const NOTIFICACION_DANGER = 2;
const NOTIFICACION_WARNING = 3;
  
  function crearTablaContactos(){

    let tabla = document.getElementById("tablaContactos");
    if(tabla) tabla.remove();


    google.script.run
    .withSuccessHandler(crearTablaContactosCorrectamente)
    .withFailureHandler(mostrarError)
    .obtenerContactos();
  }

  function crearTablaContactosCorrectamente(obj){

        tabla = document.createElement("table");
        tabla.id = "tablaContactos";

        let tablaHeader = document.createElement("thead");
        let tablaBody = document.createElement("tbody");
        let primeraFila = document.createElement("tr");

        //header de la tabla
        for (let i = 0; i<obj[0].length; i++){
            let celda = document.createElement("td");
                celda.textContent = obj[0][i];
                primeraFila.appendChild(celda);
        }
        tablaHeader.appendChild(primeraFila);
        tabla.appendChild(tablaHeader);


        //body de la tabla
        for (let i=1; i < obj.length; i++){
            let fila = document.createElement("tr");
            for (let j = 0; j < obj[i].length; j++){
                let celda = document.createElement("td");
                celda.textContent = obj[i][j];
                fila.appendChild(celda);
            }
                tablaBody.appendChild(fila);
        }

        //Agregamos clases a la cabecera
        tablaHeader.classList.add("table-dark");
        //Agregamos el cuerpo a la tabla
        tabla.appendChild(tablaBody);
        //Agregamos clases a la tabla
        tabla.classList.add("table", "table-striped", "border", "border-4", "border-dark");
        //Agregamos la tabla al div
        document.getElementById("divContactos").appendChild(tabla);

        //Mostrar notificación de ok
        crearNotificacion(NOTIFICACION_OK, 'Contactos obtenidos correctamente', 'Notificación de éxito');
    }

    function mostrarError(){
        //Mostrar notificación de error
        crearNotificacion(NOTIFICACION_DANGER, 'No se han podido leer los contactos', 'Error');

    }

    function crearNotificacion(tipo, mensaje, titutlo){
        //obtenemos datos
        let mensajeNotificacion = document.getElementById("mensajeNotificacion");
        let tituloNotificacion = document.getElementById("tituloNotificacion");
        let elementoNotificacion = document.getElementById("notificacion");
        let iconoNotificacion = document.getElementById("iconoNotificacion");
        let notificacion = bootstrap.Toast.getOrCreateInstance(elementoNotificacion);

        //editar la notificacion
        mensajeNotificacion.textContent = mensaje;
        tituloNotificacion.textContent = titutlo;

        switch(tipo){
            case NOTIFICACION_OK:
                iconoNotificacion.className = "";
                iconoNotificacion.classList.add("bi","bi-check2-square");
                elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue("--color-verde-oscuro");
                break;
            case NOTIFICACION_DANGER:
                iconoNotificacion.className = "";
                iconoNotificacion.classList.add("bi","bi-x-square");
                elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue("--color-rojo-oscuro");
                break;
            case NOTIFICACION_WARNING:
                iconoNotificacion.className = "";
                iconoNotificacion.classList.add("bi","bi-exclamation-square");
                elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue("--color-amarillo-oscuro");
                break;
        }

        //mostrar notificación
        notificacion.show();
    }

</script>